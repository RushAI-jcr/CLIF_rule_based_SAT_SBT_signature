# Marimo Notebook Rules

Use Polars over Pandas for all data manipulation — load chart audit CSVs with `pl.scan_csv()` for large files or `pl.read_csv()` for small ones, always define explicit dtypes for date, flag, and code columns, cast coding flags to `pl.Categorical`, validate row counts and expected columns immediately after load, and chain expressions (`.filter().with_columns().group_by()`) instead of row-level iteration. Use Plotly Express for interactive visualizations and Matplotlib/Seaborn for publication-quality static figures, with Altair available for quick exploratory faceted views. For Plotly, always set `labels={}` for clean axis names, include descriptive `title=`, use `color=` for grouping, set `template="plotly_white"`, and add `hover_data=` with chart ID, encounter, or provider identifiers; use `px.scatter` for flag rate vs volume, `px.line` for trends over time, `px.bar` for category comparisons, `px.box`/`px.violin` for distributions, and `px.imshow` for agreement matrices. For publication figures, use `fig, ax = plt.subplots()` (never bare `plt.plot()`), save at 300 DPI minimum as TIFF or EPS with `bbox_inches="tight"`, use Arial/Helvetica 8–12 pt only, remove top and right spines, use outward tick marks with no gridlines, put units in parentheses on axis labels, place legends at the bottom with no title or box, use bold A/B/C panel labels top-left, and only use colorblind-safe palettes (Tableau10, Okabe-Ito) that work in grayscale. For all chart audit analyses, always report flag rates (flagged/total) not raw counts, include denominators, show N per group, include 95% CIs or error bars, report exact p-values (use p < 0.001 only when appropriate), compute Cohen's kappa for inter-rater reliability, and annotate outlier thresholds directly on plots. All functions must have type hints on parameters and return values, NumPy-style docstrings, and try/except blocks catching specific exceptions (`pl.exceptions.ColumnNotFoundError`, `FileNotFoundError`, `ValueError`) with informative messages that include the operation and context. Follow PEP 8 throughout, use `ruff` for formatting, and never use 3D effects, chart junk, dual y-axes, or truncated axes without break indicators.
